(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[3],{286:function(e,s,t){e.exports={dialogs:"Dialogs_dialogs__1Dcow",dialog:"Dialogs_dialog__2rlRZ",messages:"Dialogs_messages__38Mk_",dialogs_title:"Dialogs_dialogs_title__1_0em"}},287:function(e,s,t){e.exports={dialogs:"DialogItem_dialogs__1Ogsw",dialogsItems:"DialogItem_dialogsItems__16DK3",dialog:"DialogItem_dialog__oHWe6",messages:"DialogItem_messages__1aLd7",selectedItem:"DialogItem_selectedItem__3K81j",avatar:"DialogItem_avatar__1asPg",dialogItem_content:"DialogItem_dialogItem_content__23NF8"}},288:function(e,s,t){e.exports={dialogs:"Message_dialogs__TZWUb",dialogsItems:"Message_dialogsItems__1vPxM",dialog:"Message_dialog__3wqyg",messages:"Message_messages__2akbG",message_rigth:"Message_message_rigth__1X4m5",message_left:"Message_message_left__2efCH",message__avatar:"Message_message__avatar__2wyDT",messageName:"Message_messageName__2OJIF",message__item:"Message_message__item__2ycCy",message__text:"Message_message__text__1T0oB",message__form:"Message_message__form__3LnmN",message_btn:"Message_message_btn__1EuVA",preloader_null:"Message_preloader_null__1uMc9",preloader:"Message_preloader__zqanY"}},289:function(e,s,t){"use strict";t.r(s);var a=t(30),o=t(31),n=t(33),r=t(32),i=t(2),l=t.n(i),c=t(77);function g(e,s){var t;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=Object(c.a)(e))||s&&e&&"number"===typeof e.length){t&&(e=t);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,r=!0,i=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return r=e.done,e},e:function(e){i=!0,n=e},f:function(){try{r||null==t.return||t.return()}finally{if(i)throw n}}}}var d=t(286),u=t.n(d),m=t(287),_=t.n(m),p=t(24),j=t(1),h=function(e){return Object(j.jsx)("div",{className:e.path=="/Dialogs/".concat(e.id)?_.a.dialog+" "+_.a.selectedItem:_.a.dialog,children:Object(j.jsx)(p.b,{to:"/Dialogs/"+e.id,children:Object(j.jsxs)("div",{className:_.a.dialogItem_content,children:[Object(j.jsx)("img",{className:_.a.avatar,src:e.photo,alt:"icon"}),e.name]})})})},b=t(42),f=t(62),O=t(288),v=t.n(O),w=t(133),x=t(134),I=t(104),y=t(47),M=t(16),N=t(132),D=t(34),S=t.p+"static/media/Loader.193097d2.svg",E=function(e){Object(n.a)(t,e);var s=Object(r.a)(t);function t(){var e;Object(a.a)(this,t);for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return(e=s.call.apply(s,[this].concat(n))).onSubmit=function(s){e.props.sendMessage(s.newMessage,e.props.interlocutor.userId,e.props.isOwner,e.props.ownerName)},e}return Object(o.a)(t,[{key:"componentDidMount",value:function(){console.log("\u0421opmponentDidMount MessageContainer"),this.props.loadMessages(this.props.interlocutor.userId,this.props.isOwner,20)}},{key:"componentDidUpdate",value:function(e){e.path!=this.props.path&&this.props.loadMessages(this.props.interlocutor.userId,this.props.isOwner,20)}},{key:"render",value:function(){return console.log("render"),Object(j.jsxs)("div",{children:[Object(j.jsx)(P,{sendMessage:this.props.sendMessage,isOwner:this.props.isOwner,ownerName:this.props.ownerName,ownerPhoto:this.props.ownerPhoto,loadMessages:this.props.loadMessages,interlocutor:this.props.interlocutor,message:this.props.message}),Object(j.jsx)(U,{onSubmit:this.onSubmit})]})}}]),t}(l.a.Component),P=function(e){var s=Object(i.useState)(20),t=Object(f.a)(s,2),a=t[0],o=t[1],n=Object(i.useState)(!1),r=Object(f.a)(n,2),l=r[0],c=r[1],g=Object(i.useRef)(),d=Object(i.useRef)();Object(i.useEffect)((function(){g.current.scrollIntoView({block:"center"})}),[]),Object(i.useEffect)((function(){var e=d.current;return e.addEventListener("scroll",u),function(){e.removeEventListener("scroll",u)}}));var u=function(e){console.log(e.target.scrollTop),console.log(e.currentTarget),e.target.scrollTop<40&&(c(!0),o(a+=12))};Object(i.useEffect)((function(){l&&(e.loadMessages(e.interlocutor.userId,e.isOwner,a),c(!1))}),[l]),Object(i.useEffect)((function(){o(20)}),[e.interlocutor.userId]);var m=[];e.message[e.interlocutor.userId]&&e.message[e.interlocutor.userId].length>0?Object(b.a)(e.message[e.interlocutor.userId]).map((function(s){var t=Object(j.jsxs)("div",{className:s.userId===e.isOwner?v.a.message_rigth:v.a.message_left,children:[Object(j.jsxs)("div",{className:v.a.message__item,children:[Object(j.jsx)("img",{src:s.userId==e.isOwner?e.ownerPhoto:e.interlocutor.photoURL,alt:"icon",className:v.a.message__avatar}),Object(j.jsx)("p",{className:v.a.messageName,children:s.name})]}),Object(j.jsx)("div",{className:v.a.message__text,children:s.message})]});m.push(t)})):m.push(Object(j.jsxs)("div",{children:[Object(j.jsxs)("h2",{children:["\u0412\u044b \u0435\u0449\u0435 \u043d\u0435 \u043e\u0431\u0449\u0430\u043b\u0438\u0441\u044c \u0441 ",e.interlocutor.displayName]}),Object(j.jsxs)("p",{children:["\u0414\u043b\u044f \u043d\u0430\u0447\u0430\u043b\u0430 \u043f\u043e\u0437\u0434\u0430\u0440\u043e\u0432\u0430\u0439\u0442\u0435\u0441\u044c \u0441 ",e.interlocutor.displayName]})]}));var _=function(e){return Object(j.jsx)(j.Fragment,{children:e.messageElem})};return Object(j.jsxs)("div",{className:v.a.dialog,ref:d,children:[l?Object(j.jsx)("img",{src:S,alt:"preloader",className:v.a.preloader}):Object(j.jsx)("div",{className:v.a.preloader_null}),Object(j.jsx)(_,{messageElem:m}),Object(j.jsx)("div",{ref:g})]})},k=Object(I.a)(50),U=Object(x.a)({form:"newMessage"})((function(e){return Object(j.jsx)("div",{className:v.a.message__form,children:Object(j.jsxs)("form",{onSubmit:e.handleSubmit,children:[Object(j.jsx)(w.a,{component:y.b,contenteditable:"true",placeholder:"Enter your message here",name:"newMessage",validate:[I.b,k]}),Object(j.jsx)("div",{className:v.a.message_btn,children:Object(j.jsx)(D.a,{text:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435"})})]})})})),L=Object(M.b)((function(e){return{isOwner:e.auth.isOwner,ownerName:e.auth.ownerName,ownerPhoto:e.auth.photoOwner,message:e.dialogsPage.messageData}}),{sendMessage:N.c,loadMessages:N.b,setIsFetchingStatus:N.d})(E),T=function(e){var s,t=e.props,a=[],o=g(t.followingInUserId);try{for(o.s();!(s=o.n()).done;){var n,r=s.value,i=g(t.users);try{for(i.s();!(n=i.n()).done;){var l=n.value;r==l.userId&&a.push(l)}}catch(p){i.e(p)}finally{i.f()}}}catch(p){o.e(p)}finally{o.f()}var c=a.map((function(e){return Object(j.jsx)(h,{photo:e.photoURL,name:e.displayName,id:e.userId,path:t.location.pathname})})),d=t.location.pathname.slice(9),m=t.users.findIndex((function(e){if(e.userId===d)return e})),_=t.users[m];return Object(j.jsxs)("div",{children:["/Dialogs"===t.location.pathname?Object(j.jsx)("div",{className:u.a.dialogs_title,children:c.length>0?"\u0412\u044b\u0431e\u0440\u0438\u0442\u0435 \u0434\u0438\u0430\u043b\u043e\u0433":"\u0423 \u0432\u0430\u0441 \u0435\u0449\u0435 \u043d\u0435\u0442\u0443 \u043d\u0438 \u043e\u0434\u043d\u043e\u0433\u043e \u0434\u0440\u0443\u0433\u0430. \u0414\u043b\u044f \u0442\u043e\u0433\u043e \u0447\u0442\u043e\u0431\u044b \u043d\u0430\u0447\u0430\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433, \u0432\u0430\u043c \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u0437\u0430\u0438\u043c\u043d\u043e \u043f\u043e\u0434\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f \u043d\u0430 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0433\u043e  \u0447\u0435\u043b\u043e\u0432\u0435\u043a\u0430"}):null,Object(j.jsxs)("div",{className:u.a.dialogs,children:[Object(j.jsx)("div",{className:u.a.dialogsItems,children:c}),"/Dialogs"!==t.location.pathname?Object(j.jsx)(L,{path:t.location.pathname,interlocutor:_}):null]})]})},A=t(48),F=t(25),C=t(79),R=t(14),B=t(13),J=function(e){Object(n.a)(t,e);var s=Object(r.a)(t);function t(){return Object(a.a)(this,t),s.apply(this,arguments)}return Object(o.a)(t,[{key:"componentDidMount",value:function(){this.props.getAllUsers(),this.props.getFollowers(this.props.isOwner)}},{key:"render",value:function(){return Object(j.jsx)(T,{props:this.props})}}]),t}(l.a.Component);s.default=Object(R.compose)(Object(M.b)((function(e){return{dialogsData:e.dialogsPage.dialogsData,messageBody:e.dialogsPage.newMessageBody,messageData:e.dialogsPage.messageData,followingInUserId:Object(A.c)(e),users:e.userPage.users,isOwner:e.auth.isOwner}}),{getFollowers:F.d,getAllUsers:F.c}),B.f,C.a)(J)}}]);
//# sourceMappingURL=3.85330d42.chunk.js.map